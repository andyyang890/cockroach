setup
CREATE TABLE t(
  a INT PRIMARY KEY,
  b INT,
  C INT,
  INDEX t_idx_b(b),
  INDEX t_idx_c(c)
);
CREATE SEQUENCE sq1;
CREATE VIEW v AS SELECT a FROM t;
CREATE TYPE notmyworkday AS ENUM ('Monday', 'Tuesday');
CREATE FUNCTION f(a notmyworkday) RETURNS INT VOLATILE LANGUAGE SQL AS $$
  SELECT a FROM t;
  SELECT b FROM t@t_idx_b;
  SELECT c FROM t@t_idx_c;
  SELECT a FROM v;
  SELECT nextval('sq1');
$$;
----

build
CREATE OR REPLACE FUNCTION f(a notmyworkday) RETURNS INT IMMUTABLE LANGUAGE SQL AS $$
  SELECT 1;
$$;
----
- [[FunctionVolatility:{DescID: 109}, PUBLIC], ABSENT]
  {functionId: 109, volatility: {volatility: IMMUTABLE}}
- [[FunctionLeakProof:{DescID: 109}, PUBLIC], ABSENT]
  {functionId: 109}
- [[FunctionNullInputBehavior:{DescID: 109}, PUBLIC], ABSENT]
  {functionId: 109, nullInputBehavior: {nullInputBehavior: CALLED_ON_NULL_INPUT}}
- [[FunctionSecurity:{DescID: 109}, PUBLIC], ABSENT]
  {functionId: 109, security: {}}
- [[FunctionParams:{DescID: 109}, PUBLIC], ABSENT]
  {functionId: 109, params: [{class: {}, name: a, type: {closedTypeIds: [107, 108], type: {family: EnumFamily, oid: 100107, udtMetadata: {arrayTypeOid: 100108}}, typeName: public.notmyworkday}}]}
- [[FunctionBody:{DescID: 109}, PUBLIC], ABSENT]
  {body: SELECT 1;, functionId: 109, lang: {lang: SQL}, usesTypeIds: [107, 108]}

# Replace a trigger function that has an active trigger. The trigger's
# TriggerDeps and TriggerFunctionCall should be updated via Drop+Add.
setup
CREATE TABLE tr_t (a INT PRIMARY KEY);
CREATE TABLE log1 (val TEXT);
CREATE TABLE log2 (val TEXT);
CREATE FUNCTION tf() RETURNS TRIGGER LANGUAGE PLpgSQL AS $$
  BEGIN
    INSERT INTO log1 VALUES ('fired');
    RETURN NEW;
  END
$$;
CREATE TRIGGER tr BEFORE INSERT ON tr_t FOR EACH ROW EXECUTE FUNCTION tf();
----

build
CREATE OR REPLACE FUNCTION tf() RETURNS TRIGGER LANGUAGE PLpgSQL AS $$
  BEGIN
    INSERT INTO log2 VALUES ('replaced');
    RETURN NEW;
  END
$$;
----
- [[FunctionVolatility:{DescID: 113}, PUBLIC], ABSENT]
  {functionId: 113, volatility: {volatility: VOLATILE}}
- [[FunctionLeakProof:{DescID: 113}, PUBLIC], ABSENT]
  {functionId: 113}
- [[FunctionNullInputBehavior:{DescID: 113}, PUBLIC], ABSENT]
  {functionId: 113, nullInputBehavior: {nullInputBehavior: CALLED_ON_NULL_INPUT}}
- [[FunctionSecurity:{DescID: 113}, PUBLIC], ABSENT]
  {functionId: 113, security: {}}
- [[FunctionParams:{DescID: 113}, PUBLIC], ABSENT]
  {functionId: 113, params: []}
- [[FunctionBody:{DescID: 113}, PUBLIC], ABSENT]
  {body: "\n  BEGIN\n    INSERT INTO log2 VALUES ('replaced');\n    RETURN NEW;\n  END\n", functionId: 113, lang: {lang: PLPGSQL}}
- [[IndexData:{DescID: 110, IndexID: 1}, PUBLIC], PUBLIC]
  {indexId: 1, tableId: 110}
- [[TriggerFunctionCall:{DescID: 110, TriggerID: 1}, PUBLIC], ABSENT]
  {funcBody: "BEGIN\nINSERT INTO defaultdb.public.log2 VALUES ('replaced');\nRETURN new;\nEND;\n", funcId: 113, tableId: 110, triggerId: 1}
- [[TriggerDeps:{DescID: 110, TriggerID: 1, ReferencedFunctionIDs: [113]}, PUBLIC], ABSENT]
  {tableId: 110, triggerId: 1, usesRelations: [{columnIds: [1], id: 112}], usesRoutineIds: [113]}
- [[TableData:{DescID: 110, ReferencedDescID: 100}, PUBLIC], PUBLIC]
  {databaseId: 100, tableId: 110}
